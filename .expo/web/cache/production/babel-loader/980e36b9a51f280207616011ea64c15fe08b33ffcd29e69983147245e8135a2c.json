{"ast":null,"code":"var _interopRequireDefault=require(\"@babel/runtime/helpers/interopRequireDefault\");Object.defineProperty(exports,\"__esModule\",{value:true});exports.default=void 0;var _classCallCheck2=_interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));var _createClass2=_interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));var _constants=require(\"../constants\");var _interfaces=require(\"../interfaces\");function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}var ScaleGestureDetector=exports.default=function(){function ScaleGestureDetector(callbacks){(0,_classCallCheck2.default)(this,ScaleGestureDetector);_defineProperty(this,\"onScaleBegin\",void 0);_defineProperty(this,\"onScale\",void 0);_defineProperty(this,\"onScaleEnd\",void 0);_defineProperty(this,\"focusX\",void 0);_defineProperty(this,\"focusY\",void 0);_defineProperty(this,\"currentSpan\",void 0);_defineProperty(this,\"prevSpan\",void 0);_defineProperty(this,\"initialSpan\",void 0);_defineProperty(this,\"currentTime\",void 0);_defineProperty(this,\"prevTime\",void 0);_defineProperty(this,\"inProgress\",false);_defineProperty(this,\"spanSlop\",void 0);_defineProperty(this,\"minSpan\",void 0);this.onScaleBegin=callbacks.onScaleBegin;this.onScale=callbacks.onScale;this.onScaleEnd=callbacks.onScaleEnd;this.spanSlop=_constants.DEFAULT_TOUCH_SLOP*2;this.minSpan=0;}(0,_createClass2.default)(ScaleGestureDetector,[{key:\"onTouchEvent\",value:function onTouchEvent(event,tracker){this.currentTime=event.time;var action=event.eventType;var numOfPointers=tracker.getTrackedPointersCount();var streamComplete=action===_interfaces.EventTypes.UP||action===_interfaces.EventTypes.ADDITIONAL_POINTER_UP||action===_interfaces.EventTypes.CANCEL;if(action===_interfaces.EventTypes.DOWN||streamComplete){if(this.inProgress){this.onScaleEnd(this);this.inProgress=false;this.initialSpan=0;}if(streamComplete){return true;}}var configChanged=action===_interfaces.EventTypes.DOWN||action===_interfaces.EventTypes.ADDITIONAL_POINTER_UP||action===_interfaces.EventTypes.ADDITIONAL_POINTER_DOWN;var pointerUp=action===_interfaces.EventTypes.ADDITIONAL_POINTER_UP;var ignoredPointer=pointerUp?event.pointerId:undefined;var div=pointerUp?numOfPointers-1:numOfPointers;var sumX=tracker.getSumX(ignoredPointer);var sumY=tracker.getSumY(ignoredPointer);var focusX=sumX/div;var focusY=sumY/div;var devSumX=0;var devSumY=0;tracker.getData().forEach(function(value,key){if(key===ignoredPointer){return;}devSumX+=Math.abs(value.lastX-focusX);devSumY+=Math.abs(value.lastY-focusY);});var devX=devSumX/div;var devY=devSumY/div;var spanX=devX*2;var spanY=devY*2;var span=Math.hypot(spanX,spanY);var wasInProgress=this.inProgress;this.focusX=focusX;this.focusY=focusY;if(this.inProgress&&(span<this.minSpan||configChanged)){this.onScaleEnd(this);this.inProgress=false;this.initialSpan=span;}if(configChanged){this.initialSpan=this.prevSpan=this.currentSpan=span;}if(!this.inProgress&&span>=this.minSpan&&(wasInProgress||Math.abs(span-this.initialSpan)>this.spanSlop)){this.prevSpan=this.currentSpan=span;this.prevTime=this.currentTime;this.inProgress=this.onScaleBegin(this);}if(action!==_interfaces.EventTypes.MOVE){return true;}this.currentSpan=span;if(this.inProgress&&!this.onScale(this)){return true;}this.prevSpan=this.currentSpan;this.prevTime=this.currentTime;return true;}},{key:\"getCurrentSpan\",value:function getCurrentSpan(){return this.currentSpan;}},{key:\"getFocusX\",value:function getFocusX(){return this.focusX;}},{key:\"getFocusY\",value:function getFocusY(){return this.focusY;}},{key:\"getTimeDelta\",value:function getTimeDelta(){return this.currentTime-this.prevTime;}},{key:\"getScaleFactor\",value:function getScaleFactor(numOfPointers){if(numOfPointers<2){return 1;}return this.prevSpan>0?this.currentSpan/this.prevSpan:1;}}]);return ScaleGestureDetector;}();","map":{"version":3,"names":["_constants","require","_interfaces","ScaleGestureDetector","exports","default","callbacks","_classCallCheck2","_defineProperty","onScaleBegin","onScale","onScaleEnd","spanSlop","DEFAULT_TOUCH_SLOP","minSpan","_createClass2","key","value","onTouchEvent","event","tracker","currentTime","time","action","eventType","numOfPointers","getTrackedPointersCount","streamComplete","EventTypes","UP","ADDITIONAL_POINTER_UP","CANCEL","DOWN","inProgress","initialSpan","configChanged","ADDITIONAL_POINTER_DOWN","pointerUp","ignoredPointer","pointerId","undefined","div","sumX","getSumX","sumY","getSumY","focusX","focusY","devSumX","devSumY","getData","forEach","Math","abs","lastX","lastY","devX","devY","spanX","spanY","span","hypot","wasInProgress","prevSpan","currentSpan","prevTime","MOVE","getCurrentSpan","getFocusX","getFocusY","getTimeDelta","getScaleFactor"],"sources":["/Users/shayan/workspace/godfather/node_modules/react-native-gesture-handler/lib/module/web/detectors/ScaleGestureDetector.ts"],"sourcesContent":["import { DEFAULT_TOUCH_SLOP } from '../constants';\nimport { AdaptedEvent, EventTypes } from '../interfaces';\n\nimport PointerTracker from '../tools/PointerTracker';\n\nexport interface ScaleGestureListener {\n  onScaleBegin: (detector: ScaleGestureDetector) => boolean;\n  onScale: (detector: ScaleGestureDetector) => boolean;\n  onScaleEnd: (detector: ScaleGestureDetector) => void;\n}\n\nexport default class ScaleGestureDetector implements ScaleGestureListener {\n  public onScaleBegin: (detector: ScaleGestureDetector) => boolean;\n  public onScale: (detector: ScaleGestureDetector) => boolean;\n  public onScaleEnd: (detector: ScaleGestureDetector) => void;\n\n  private focusX!: number;\n  private focusY!: number;\n\n  private currentSpan!: number;\n  private prevSpan!: number;\n  private initialSpan!: number;\n\n  private currentTime!: number;\n  private prevTime!: number;\n\n  private inProgress = false;\n\n  private spanSlop: number;\n  private minSpan: number;\n\n  public constructor(callbacks: ScaleGestureListener) {\n    this.onScaleBegin = callbacks.onScaleBegin;\n    this.onScale = callbacks.onScale;\n    this.onScaleEnd = callbacks.onScaleEnd;\n\n    this.spanSlop = DEFAULT_TOUCH_SLOP * 2;\n    this.minSpan = 0;\n  }\n\n  public onTouchEvent(event: AdaptedEvent, tracker: PointerTracker): boolean {\n    this.currentTime = event.time;\n\n    const action: EventTypes = event.eventType;\n    const numOfPointers = tracker.getTrackedPointersCount();\n\n    const streamComplete: boolean =\n      action === EventTypes.UP ||\n      action === EventTypes.ADDITIONAL_POINTER_UP ||\n      action === EventTypes.CANCEL;\n\n    if (action === EventTypes.DOWN || streamComplete) {\n      if (this.inProgress) {\n        this.onScaleEnd(this);\n        this.inProgress = false;\n        this.initialSpan = 0;\n      }\n\n      if (streamComplete) {\n        return true;\n      }\n    }\n\n    const configChanged: boolean =\n      action === EventTypes.DOWN ||\n      action === EventTypes.ADDITIONAL_POINTER_UP ||\n      action === EventTypes.ADDITIONAL_POINTER_DOWN;\n\n    const pointerUp = action === EventTypes.ADDITIONAL_POINTER_UP;\n\n    const ignoredPointer: number | undefined = pointerUp\n      ? event.pointerId\n      : undefined;\n\n    //Determine focal point\n\n    const div: number = pointerUp ? numOfPointers - 1 : numOfPointers;\n\n    const sumX = tracker.getSumX(ignoredPointer);\n    const sumY = tracker.getSumY(ignoredPointer);\n\n    const focusX = sumX / div;\n    const focusY = sumY / div;\n\n    //Determine average deviation from focal point\n\n    let devSumX = 0;\n    let devSumY = 0;\n\n    tracker.getData().forEach((value, key) => {\n      if (key === ignoredPointer) {\n        return;\n      }\n\n      devSumX += Math.abs(value.lastX - focusX);\n      devSumY += Math.abs(value.lastY - focusY);\n    });\n\n    const devX: number = devSumX / div;\n    const devY: number = devSumY / div;\n\n    const spanX: number = devX * 2;\n    const spanY: number = devY * 2;\n\n    const span = Math.hypot(spanX, spanY);\n\n    //Begin/end events\n    const wasInProgress: boolean = this.inProgress;\n    this.focusX = focusX;\n    this.focusY = focusY;\n\n    if (this.inProgress && (span < this.minSpan || configChanged)) {\n      this.onScaleEnd(this);\n      this.inProgress = false;\n      this.initialSpan = span;\n    }\n\n    if (configChanged) {\n      this.initialSpan = this.prevSpan = this.currentSpan = span;\n    }\n\n    if (\n      !this.inProgress &&\n      span >= this.minSpan &&\n      (wasInProgress || Math.abs(span - this.initialSpan) > this.spanSlop)\n    ) {\n      this.prevSpan = this.currentSpan = span;\n      this.prevTime = this.currentTime;\n      this.inProgress = this.onScaleBegin(this);\n    }\n\n    //Handle motion\n    if (action !== EventTypes.MOVE) {\n      return true;\n    }\n\n    this.currentSpan = span;\n\n    if (this.inProgress && !this.onScale(this)) {\n      return true;\n    }\n\n    this.prevSpan = this.currentSpan;\n    this.prevTime = this.currentTime;\n\n    return true;\n  }\n\n  public getCurrentSpan(): number {\n    return this.currentSpan;\n  }\n\n  public getFocusX(): number {\n    return this.focusX;\n  }\n\n  public getFocusY(): number {\n    return this.focusY;\n  }\n\n  public getTimeDelta(): number {\n    return this.currentTime - this.prevTime;\n  }\n\n  public getScaleFactor(numOfPointers: number): number {\n    if (numOfPointers < 2) {\n      return 1;\n    }\n\n    return this.prevSpan > 0 ? this.currentSpan / this.prevSpan : 1;\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}