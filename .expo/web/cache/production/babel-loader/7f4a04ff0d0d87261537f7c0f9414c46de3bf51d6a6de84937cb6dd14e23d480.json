{"ast":null,"code":"var _interopRequireDefault=require(\"@babel/runtime/helpers/interopRequireDefault\");Object.defineProperty(exports,\"__esModule\",{value:true});exports.useDerivedValue=useDerivedValue;var _toConsumableArray2=_interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));var _react=require(\"react\");var _animation=require(\"../animation\");var _core=require(\"../core\");var _PlatformChecker=require(\"../PlatformChecker\");var _worklet_6829278738812_init_data={code:\"function anonymous(){const{sharedValue,processor}=this._closure;sharedValue.value=processor();}\",location:\"node_modules/react-native-reanimated/lib/module/reanimated2/hook/useDerivedValue.js\"};function useDerivedValue(processor,dependencies){var _processor$_closure;var initRef=(0,_react.useRef)(null);var inputs=Object.values((_processor$_closure=processor._closure)!=null?_processor$_closure:{});if((0,_PlatformChecker.shouldBeUseWeb)()){var _dependencies;if(!inputs.length&&(_dependencies=dependencies)!==null&&_dependencies!==void 0&&_dependencies.length){inputs=dependencies;}}if(dependencies===undefined){dependencies=[].concat((0,_toConsumableArray2.default)(inputs),[processor.__workletHash]);}else{dependencies.push(processor.__workletHash);}if(initRef.current===null){initRef.current=(0,_core.makeMutable)((0,_animation.initialUpdaterRun)(processor));}var sharedValue=initRef.current;(0,_react.useEffect)(function(){var fun=function(){var _f=function _f(){sharedValue.value=processor();};_f._closure={sharedValue:sharedValue,processor:processor};_f.__initData=_worklet_6829278738812_init_data;_f.__workletHash=6829278738812;return _f;}();var mapperId=(0,_core.startMapper)(fun,inputs,[sharedValue]);return function(){(0,_core.stopMapper)(mapperId);};},dependencies);(0,_react.useEffect)(function(){return function(){initRef.current=null;};},[]);return sharedValue;}","map":{"version":3,"names":["_react","require","_animation","_core","_PlatformChecker","_worklet_6829278738812_init_data","code","location","useDerivedValue","processor","dependencies","_processor$_closure","initRef","useRef","inputs","Object","values","_closure","shouldBeUseWeb","_dependencies","length","undefined","concat","_toConsumableArray2","default","__workletHash","push","current","makeMutable","initialUpdaterRun","sharedValue","useEffect","fun","_f","value","__initData","mapperId","startMapper","stopMapper"],"sources":["/Users/shayan/workspace/godfather/node_modules/react-native-reanimated/lib/module/reanimated2/hook/useDerivedValue.ts"],"sourcesContent":["import { useEffect, useRef } from 'react';\nimport { initialUpdaterRun } from '../animation';\nimport { BasicWorkletFunction, SharedValue } from '../commonTypes';\nimport { makeMutable, startMapper, stopMapper } from '../core';\nimport { DependencyList } from './commonTypes';\nimport { shouldBeUseWeb } from '../PlatformChecker';\n\nexport type DerivedValue<T> = Readonly<SharedValue<T>>;\n\nexport function useDerivedValue<T>(\n  processor: BasicWorkletFunction<T>,\n  dependencies: DependencyList\n): DerivedValue<T> {\n  const initRef = useRef<SharedValue<T> | null>(null);\n  let inputs = Object.values(processor._closure ?? {});\n  if (shouldBeUseWeb()) {\n    if (!inputs.length && dependencies?.length) {\n      // let web work without a Babel/SWC plugin\n      inputs = dependencies;\n    }\n  }\n\n  // build dependencies\n  if (dependencies === undefined) {\n    dependencies = [...inputs, processor.__workletHash];\n  } else {\n    dependencies.push(processor.__workletHash);\n  }\n\n  if (initRef.current === null) {\n    initRef.current = makeMutable(initialUpdaterRun(processor));\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  const sharedValue: SharedValue<T> = initRef.current!;\n\n  useEffect(() => {\n    const fun = () => {\n      'worklet';\n      sharedValue.value = processor();\n    };\n    const mapperId = startMapper(fun, inputs, [sharedValue]);\n    return () => {\n      stopMapper(mapperId);\n    };\n  }, dependencies);\n\n  useEffect(() => {\n    return () => {\n      initRef.current = null;\n    };\n  }, []);\n\n  return sharedValue;\n}\n"],"mappings":"wRAAA,IAAAA,MAAA,CAAAC,OAAA,UACA,IAAAC,UAAA,CAAAD,OAAA,iBAEA,IAAAE,KAAA,CAAAF,OAAA,YAEA,IAAAG,gBAAA,CAAAH,OAAA,uBAAmD,IAAAI,gCAAA,EAAAC,IAAA,mGAAAC,QAAA,wFAI5C,QAAS,CAAAC,eAAeA,CAC7BC,SAAkC,CAClCC,YAA4B,CACX,KAAAC,mBAAA,CACjB,GAAM,CAAAC,OAAO,CAAG,GAAAC,aAAM,EAAwB,IAAI,CAAC,CACnD,GAAI,CAAAC,MAAM,CAAGC,MAAM,CAACC,MAAM,EAAAL,mBAAA,CAACF,SAAS,CAACQ,QAAQ,QAAAN,mBAAA,CAAI,CAAC,CAAC,CAAC,CACpD,GAAI,GAAAO,+BAAc,GAAE,CAAE,KAAAC,aAAA,CACpB,GAAI,CAACL,MAAM,CAACM,MAAM,GAAAD,aAAA,CAAIT,YAAY,UAAAS,aAAA,WAAZA,aAAA,CAAcC,MAAM,CAAE,CAE1CN,MAAM,CAAGJ,YAAY,CACvB,CACF,CAGA,GAAIA,YAAY,GAAKW,SAAS,CAAE,CAC9BX,YAAY,IAAAY,MAAA,IAAAC,mBAAA,CAAAC,OAAA,EAAOV,MAAM,GAAEL,SAAS,CAACgB,aAAa,EAAC,CACrD,CAAC,IAAM,CACLf,YAAY,CAACgB,IAAI,CAACjB,SAAS,CAACgB,aAAa,CAAC,CAC5C,CAEA,GAAIb,OAAO,CAACe,OAAO,GAAK,IAAI,CAAE,CAC5Bf,OAAO,CAACe,OAAO,CAAG,GAAAC,iBAAW,EAAC,GAAAC,4BAAiB,EAACpB,SAAS,CAAC,CAAC,CAC7D,CAGA,GAAM,CAAAqB,WAA2B,CAAGlB,OAAO,CAACe,OAAQ,CAEpD,GAAAI,gBAAS,EAAC,UAAM,CACd,GAAM,CAAAC,GAAG,gBAAAC,EAAA,UAAAA,GAAA,CAAS,CAEhBH,WAAW,CAACI,KAAK,CAAGzB,SAAS,EAAE,CACjC,CAAC,CAAAwB,EAAA,CAAAhB,QAAA,EAAAa,WAAA,CAvCLA,WAAS,CAAArB,SAAA,CAAAA,SAAiB,EAAAwB,EAAA,CAAAE,UAAA,CAAA9B,gCAAA,CAAA4B,EAAA,CAAAR,aAAA,sBAAAQ,EAAA,IAuCrB,CACD,GAAM,CAAAG,QAAQ,CAAG,GAAAC,iBAAW,EAACL,GAAG,CAAElB,MAAM,CAAE,CAACgB,WAAW,CAAC,CAAC,CACxD,MAAO,WAAM,CACX,GAAAQ,gBAAU,EAACF,QAAQ,CAAC,CACtB,CAAC,CACH,CAAC,CAAE1B,YAAY,CAAC,CAEhB,GAAAqB,gBAAS,EAAC,UAAM,CACd,MAAO,WAAM,CACXnB,OAAO,CAACe,OAAO,CAAG,IAAI,CACxB,CAAC,CACH,CAAC,CAAE,EAAE,CAAC,CAEN,MAAO,CAAAG,WAAW,CACpB"},"metadata":{},"sourceType":"script","externalDependencies":[]}