{"ast":null,"code":"var _interopRequireDefault=require(\"@babel/runtime/helpers/interopRequireDefault\");Object.defineProperty(exports,\"__esModule\",{value:true});exports.default=void 0;var _slicedToArray2=_interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));var _classCallCheck2=_interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));var _createClass2=_interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));var _interfaces=require(\"../interfaces\");function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}var RotationGestureDetector=exports.default=function(){function RotationGestureDetector(callbacks){(0,_classCallCheck2.default)(this,RotationGestureDetector);_defineProperty(this,\"onRotationBegin\",void 0);_defineProperty(this,\"onRotation\",void 0);_defineProperty(this,\"onRotationEnd\",void 0);_defineProperty(this,\"currentTime\",0);_defineProperty(this,\"previousTime\",0);_defineProperty(this,\"previousAngle\",0);_defineProperty(this,\"rotation\",0);_defineProperty(this,\"anchorX\",0);_defineProperty(this,\"anchorY\",0);_defineProperty(this,\"isInProgress\",false);_defineProperty(this,\"keyPointers\",[NaN,NaN]);this.onRotationBegin=callbacks.onRotationBegin;this.onRotation=callbacks.onRotation;this.onRotationEnd=callbacks.onRotationEnd;}(0,_createClass2.default)(RotationGestureDetector,[{key:\"updateCurrent\",value:function updateCurrent(event,tracker){this.previousTime=this.currentTime;this.currentTime=event.time;var _this$keyPointers=(0,_slicedToArray2.default)(this.keyPointers,2),firstPointerID=_this$keyPointers[0],secondPointerID=_this$keyPointers[1];var firstPointerX=tracker.getLastX(firstPointerID);var firstPointerY=tracker.getLastY(firstPointerID);var secondPointerX=tracker.getLastX(secondPointerID);var secondPointerY=tracker.getLastY(secondPointerID);var vectorX=secondPointerX-firstPointerX;var vectorY=secondPointerY-firstPointerY;this.anchorX=(firstPointerX+secondPointerX)/2;this.anchorY=(firstPointerY+secondPointerY)/2;var angle=-Math.atan2(vectorY,vectorX);this.rotation=Number.isNaN(this.previousAngle)?0:this.previousAngle-angle;this.previousAngle=angle;if(this.rotation>Math.PI){this.rotation-=Math.PI;}else if(this.rotation<-Math.PI){this.rotation+=Math.PI;}if(this.rotation>Math.PI/2){this.rotation-=Math.PI;}else if(this.rotation<-Math.PI/2){this.rotation+=Math.PI;}}},{key:\"finish\",value:function finish(){if(!this.isInProgress){return;}this.isInProgress=false;this.keyPointers=[NaN,NaN];this.onRotationEnd(this);}},{key:\"setKeyPointers\",value:function setKeyPointers(tracker){if(this.keyPointers[0]&&this.keyPointers[1]){return;}var pointerIDs=tracker.getData().keys();this.keyPointers[0]=pointerIDs.next().value;this.keyPointers[1]=pointerIDs.next().value;}},{key:\"onTouchEvent\",value:function onTouchEvent(event,tracker){switch(event.eventType){case _interfaces.EventTypes.DOWN:this.isInProgress=false;break;case _interfaces.EventTypes.ADDITIONAL_POINTER_DOWN:if(this.isInProgress){break;}this.isInProgress=true;this.previousTime=event.time;this.previousAngle=NaN;this.setKeyPointers(tracker);this.updateCurrent(event,tracker);this.onRotationBegin(this);break;case _interfaces.EventTypes.MOVE:if(!this.isInProgress){break;}this.updateCurrent(event,tracker);this.onRotation(this);break;case _interfaces.EventTypes.ADDITIONAL_POINTER_UP:if(!this.isInProgress){break;}if(this.keyPointers.indexOf(event.pointerId)>=0){this.finish();}break;case _interfaces.EventTypes.UP:if(this.isInProgress){this.finish();}break;}return true;}},{key:\"getTimeDelta\",value:function getTimeDelta(){return this.currentTime+this.previousTime;}},{key:\"getAnchorX\",value:function getAnchorX(){return this.anchorX;}},{key:\"getAnchorY\",value:function getAnchorY(){return this.anchorY;}},{key:\"getRotation\",value:function getRotation(){return this.rotation;}},{key:\"reset\",value:function reset(){this.keyPointers=[NaN,NaN];this.isInProgress=false;}}]);return RotationGestureDetector;}();","map":{"version":3,"names":["_interfaces","require","RotationGestureDetector","exports","default","callbacks","_classCallCheck2","_defineProperty","NaN","onRotationBegin","onRotation","onRotationEnd","_createClass2","key","value","updateCurrent","event","tracker","previousTime","currentTime","time","_this$keyPointers","_slicedToArray2","keyPointers","firstPointerID","secondPointerID","firstPointerX","getLastX","firstPointerY","getLastY","secondPointerX","secondPointerY","vectorX","vectorY","anchorX","anchorY","angle","Math","atan2","rotation","Number","isNaN","previousAngle","PI","finish","isInProgress","setKeyPointers","pointerIDs","getData","keys","next","onTouchEvent","eventType","EventTypes","DOWN","ADDITIONAL_POINTER_DOWN","MOVE","ADDITIONAL_POINTER_UP","indexOf","pointerId","UP","getTimeDelta","getAnchorX","getAnchorY","getRotation","reset"],"sources":["/Users/shayan/workspace/godfather/node_modules/react-native-gesture-handler/lib/module/web/detectors/RotationGestureDetector.ts"],"sourcesContent":["import { AdaptedEvent, EventTypes } from '../interfaces';\nimport PointerTracker from '../tools/PointerTracker';\n\nexport interface RotationGestureListener {\n  onRotationBegin: (detector: RotationGestureDetector) => boolean;\n  onRotation: (detector: RotationGestureDetector) => boolean;\n  onRotationEnd: (detector: RotationGestureDetector) => void;\n}\n\nexport default class RotationGestureDetector\n  implements RotationGestureListener\n{\n  onRotationBegin: (detector: RotationGestureDetector) => boolean;\n  onRotation: (detector: RotationGestureDetector) => boolean;\n  onRotationEnd: (detector: RotationGestureDetector) => void;\n\n  private currentTime = 0;\n  private previousTime = 0;\n\n  private previousAngle = 0;\n  private rotation = 0;\n\n  private anchorX = 0;\n  private anchorY = 0;\n\n  private isInProgress = false;\n\n  private keyPointers: number[] = [NaN, NaN];\n\n  constructor(callbacks: RotationGestureListener) {\n    this.onRotationBegin = callbacks.onRotationBegin;\n    this.onRotation = callbacks.onRotation;\n    this.onRotationEnd = callbacks.onRotationEnd;\n  }\n\n  private updateCurrent(event: AdaptedEvent, tracker: PointerTracker): void {\n    this.previousTime = this.currentTime;\n    this.currentTime = event.time;\n\n    const [firstPointerID, secondPointerID] = this.keyPointers;\n\n    const firstPointerX: number = tracker.getLastX(firstPointerID);\n    const firstPointerY: number = tracker.getLastY(firstPointerID);\n    const secondPointerX: number = tracker.getLastX(secondPointerID);\n    const secondPointerY: number = tracker.getLastY(secondPointerID);\n\n    const vectorX: number = secondPointerX - firstPointerX;\n    const vectorY: number = secondPointerY - firstPointerY;\n\n    this.anchorX = (firstPointerX + secondPointerX) / 2;\n    this.anchorY = (firstPointerY + secondPointerY) / 2;\n\n    //Angle diff should be positive when rotating in clockwise direction\n    const angle: number = -Math.atan2(vectorY, vectorX);\n\n    this.rotation = Number.isNaN(this.previousAngle)\n      ? 0\n      : this.previousAngle - angle;\n\n    this.previousAngle = angle;\n\n    if (this.rotation > Math.PI) {\n      this.rotation -= Math.PI;\n    } else if (this.rotation < -Math.PI) {\n      this.rotation += Math.PI;\n    }\n\n    if (this.rotation > Math.PI / 2) {\n      this.rotation -= Math.PI;\n    } else if (this.rotation < -Math.PI / 2) {\n      this.rotation += Math.PI;\n    }\n  }\n\n  private finish(): void {\n    if (!this.isInProgress) {\n      return;\n    }\n\n    this.isInProgress = false;\n    this.keyPointers = [NaN, NaN];\n    this.onRotationEnd(this);\n  }\n\n  private setKeyPointers(tracker: PointerTracker): void {\n    if (this.keyPointers[0] && this.keyPointers[1]) {\n      return;\n    }\n\n    const pointerIDs: IterableIterator<number> = tracker.getData().keys();\n\n    this.keyPointers[0] = pointerIDs.next().value as number;\n    this.keyPointers[1] = pointerIDs.next().value as number;\n  }\n\n  public onTouchEvent(event: AdaptedEvent, tracker: PointerTracker): boolean {\n    switch (event.eventType) {\n      case EventTypes.DOWN:\n        this.isInProgress = false;\n        break;\n\n      case EventTypes.ADDITIONAL_POINTER_DOWN:\n        if (this.isInProgress) {\n          break;\n        }\n        this.isInProgress = true;\n\n        this.previousTime = event.time;\n        this.previousAngle = NaN;\n\n        this.setKeyPointers(tracker);\n\n        this.updateCurrent(event, tracker);\n        this.onRotationBegin(this);\n        break;\n\n      case EventTypes.MOVE:\n        if (!this.isInProgress) {\n          break;\n        }\n\n        this.updateCurrent(event, tracker);\n        this.onRotation(this);\n\n        break;\n\n      case EventTypes.ADDITIONAL_POINTER_UP:\n        if (!this.isInProgress) {\n          break;\n        }\n\n        if (this.keyPointers.indexOf(event.pointerId) >= 0) {\n          this.finish();\n        }\n\n        break;\n\n      case EventTypes.UP:\n        if (this.isInProgress) {\n          this.finish();\n        }\n        break;\n    }\n\n    return true;\n  }\n\n  public getTimeDelta(): number {\n    return this.currentTime + this.previousTime;\n  }\n\n  public getAnchorX(): number {\n    return this.anchorX;\n  }\n\n  public getAnchorY(): number {\n    return this.anchorY;\n  }\n\n  public getRotation(): number {\n    return this.rotation;\n  }\n\n  public reset(): void {\n    this.keyPointers = [NaN, NaN];\n    this.isInProgress = false;\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}