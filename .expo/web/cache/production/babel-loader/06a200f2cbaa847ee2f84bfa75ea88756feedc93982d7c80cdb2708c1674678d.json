{"ast":null,"code":"var _interopRequireDefault=require(\"@babel/runtime/helpers/interopRequireDefault\");Object.defineProperty(exports,\"__esModule\",{value:true});exports.JSPropUpdater=void 0;var _regenerator=_interopRequireDefault(require(\"@babel/runtime/regenerator\"));var _classCallCheck2=_interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));var _createClass2=_interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));var _reactNative=require(\"react-native\");var _PlatformChecker=require(\"../reanimated2/PlatformChecker\");function _defineProperty(obj,key,value){key=_toPropertyKey(key);if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _toPropertyKey(arg){var key=_toPrimitive(arg,\"string\");return typeof key===\"symbol\"?key:String(key);}function _toPrimitive(input,hint){if(typeof input!==\"object\"||input===null)return input;var prim=input[Symbol.toPrimitive];if(prim!==undefined){var res=prim.call(input,hint||\"default\");if(typeof res!==\"object\")return res;throw new TypeError(\"@@toPrimitive must return a primitive value.\");}return(hint===\"string\"?String:Number)(input);}var JSPropUpdater=exports.JSPropUpdater=function(){function JSPropUpdater(){(0,_classCallCheck2.default)(this,JSPropUpdater);_defineProperty(this,\"_reanimatedEventEmitter\",void 0);var reanimatedModule;if((0,_PlatformChecker.nativeShouldBeMock)()){reanimatedModule=JSPropUpdater._reanimatedModuleMock;}else{reanimatedModule=_reactNative.NativeModules.ReanimatedModule;}this._reanimatedEventEmitter=new _reactNative.NativeEventEmitter(reanimatedModule);}(0,_createClass2.default)(JSPropUpdater,[{key:\"addOnJSPropsChangeListener\",value:function addOnJSPropsChangeListener(animatedComponent){var viewTag=(0,_reactNative.findNodeHandle)(animatedComponent);JSPropUpdater._tagToComponentMapping.set(viewTag,animatedComponent);if(JSPropUpdater._tagToComponentMapping.size===1){this._reanimatedEventEmitter.addListener('onReanimatedPropsChange',JSPropUpdater._listener);}}},{key:\"removeOnJSPropsChangeListener\",value:function removeOnJSPropsChangeListener(animatedComponent){var viewTag=(0,_reactNative.findNodeHandle)(animatedComponent);JSPropUpdater._tagToComponentMapping.delete(viewTag);if(JSPropUpdater._tagToComponentMapping.size===0){this._reanimatedEventEmitter.removeAllListeners('onReanimatedPropsChange');}}}],[{key:\"_listener\",value:function _listener(data){var component=JSPropUpdater._tagToComponentMapping.get(data.viewTag);component&&component._updateFromNative(data.props);}}]);return JSPropUpdater;}();_defineProperty(JSPropUpdater,\"_tagToComponentMapping\",new Map());_defineProperty(JSPropUpdater,\"_reanimatedModuleMock\",{addListener:function addListener(){return function _callee(){return _regenerator.default.async(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:case\"end\":return _context.stop();}},null,null,null,Promise);}();},removeListeners:function removeListeners(){return function _callee2(){return _regenerator.default.async(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:case\"end\":return _context2.stop();}},null,null,null,Promise);}();}});","map":{"version":3,"names":["_reactNative","require","_PlatformChecker","JSPropUpdater","exports","_classCallCheck2","default","_defineProperty","reanimatedModule","nativeShouldBeMock","_reanimatedModuleMock","NativeModules","ReanimatedModule","_reanimatedEventEmitter","NativeEventEmitter","_createClass2","key","value","addOnJSPropsChangeListener","animatedComponent","viewTag","findNodeHandle","_tagToComponentMapping","set","size","addListener","_listener","removeOnJSPropsChangeListener","delete","removeAllListeners","data","component","get","_updateFromNative","props","Map","_callee","_regenerator","async","_callee$","_context","prev","next","stop","Promise","removeListeners","_callee2","_callee2$","_context2"],"sources":["/Users/shayan/workspace/godfather/node_modules/react-native-reanimated/lib/module/createAnimatedComponent/JSPropUpdater.ts"],"sourcesContent":["import {\n  NativeEventEmitter,\n  NativeModules,\n  findNodeHandle,\n} from 'react-native';\nimport { nativeShouldBeMock } from '../reanimated2/PlatformChecker';\nimport type { StyleProps } from '../reanimated2';\n\ninterface ListenerData {\n  viewTag: number;\n  props: StyleProps;\n}\n\nexport class JSPropUpdater {\n  private static _tagToComponentMapping = new Map();\n  private _reanimatedEventEmitter: NativeEventEmitter;\n  private static _reanimatedModuleMock = {\n    async addListener(): Promise<void> {\n      // noop\n    },\n    async removeListeners(): Promise<void> {\n      // noop\n    },\n  };\n\n  private static _listener(data: ListenerData) {\n    const component = JSPropUpdater._tagToComponentMapping.get(data.viewTag);\n    component && component._updateFromNative(data.props);\n  }\n\n  constructor() {\n    let reanimatedModule: typeof JSPropUpdater._reanimatedModuleMock;\n    if (nativeShouldBeMock()) {\n      reanimatedModule = JSPropUpdater._reanimatedModuleMock;\n    } else {\n      reanimatedModule = NativeModules.ReanimatedModule;\n    }\n    this._reanimatedEventEmitter = new NativeEventEmitter(reanimatedModule);\n  }\n\n  public addOnJSPropsChangeListener(\n    animatedComponent: React.Component<unknown, unknown>\n  ) {\n    const viewTag = findNodeHandle(animatedComponent);\n    JSPropUpdater._tagToComponentMapping.set(viewTag, animatedComponent);\n    if (JSPropUpdater._tagToComponentMapping.size === 1) {\n      this._reanimatedEventEmitter.addListener(\n        'onReanimatedPropsChange',\n        JSPropUpdater._listener\n      );\n    }\n  }\n\n  public removeOnJSPropsChangeListener(\n    animatedComponent: React.Component<unknown, unknown>\n  ) {\n    const viewTag = findNodeHandle(animatedComponent);\n    JSPropUpdater._tagToComponentMapping.delete(viewTag);\n    if (JSPropUpdater._tagToComponentMapping.size === 0) {\n      this._reanimatedEventEmitter.removeAllListeners(\n        'onReanimatedPropsChange'\n      );\n    }\n  }\n}\n"],"mappings":"8aAAA,IAAAA,YAAA,CAAAC,OAAA,iBAKA,IAAAC,gBAAA,CAAAD,OAAA,mC,+oBAQa,CAAAE,aAAa,CAAAC,OAAA,CAAAD,aAAA,YAiBxB,SAAAA,cAAA,CAAc,IAAAE,gBAAA,CAAAC,OAAA,OAAAH,aAAA,EAAAI,eAAA,wCACZ,GAAI,CAAAC,gBAA4D,CAChE,GAAI,GAAAC,mCAAkB,GAAE,CAAE,CACxBD,gBAAgB,CAAGL,aAAa,CAACO,qBAAqB,CACxD,CAAC,IAAM,CACLF,gBAAgB,CAAGG,0BAAa,CAACC,gBAAgB,CACnD,CACA,IAAI,CAACC,uBAAuB,CAAG,GAAI,CAAAC,+BAAkB,CAACN,gBAAgB,CAAC,CACzE,IAAAO,aAAA,CAAAT,OAAA,EAAAH,aAAA,GAAAa,GAAA,8BAAAC,KAAA,CAEO,SAAAC,2BACLC,iBAAoD,CACpD,CACA,GAAM,CAAAC,OAAO,CAAG,GAAAC,2BAAc,EAACF,iBAAiB,CAAC,CACjDhB,aAAa,CAACmB,sBAAsB,CAACC,GAAG,CAACH,OAAO,CAAED,iBAAiB,CAAC,CACpE,GAAIhB,aAAa,CAACmB,sBAAsB,CAACE,IAAI,GAAK,CAAC,CAAE,CACnD,IAAI,CAACX,uBAAuB,CAACY,WAAW,CACtC,yBAAyB,CACzBtB,aAAa,CAACuB,SAAS,CACxB,CACH,CACF,IAAAV,GAAA,iCAAAC,KAAA,CAEO,SAAAU,8BACLR,iBAAoD,CACpD,CACA,GAAM,CAAAC,OAAO,CAAG,GAAAC,2BAAc,EAACF,iBAAiB,CAAC,CACjDhB,aAAa,CAACmB,sBAAsB,CAACM,MAAM,CAACR,OAAO,CAAC,CACpD,GAAIjB,aAAa,CAACmB,sBAAsB,CAACE,IAAI,GAAK,CAAC,CAAE,CACnD,IAAI,CAACX,uBAAuB,CAACgB,kBAAkB,CAC7C,yBAAyB,CAC1B,CACH,CACF,MAAAb,GAAA,aAAAC,KAAA,CAtCA,SAAAS,UAAyBI,IAAkB,CAAE,CAC3C,GAAM,CAAAC,SAAS,CAAG5B,aAAa,CAACmB,sBAAsB,CAACU,GAAG,CAACF,IAAI,CAACV,OAAO,CAAC,CACxEW,SAAS,EAAIA,SAAS,CAACE,iBAAiB,CAACH,IAAI,CAACI,KAAK,CAAC,CACtD,YAAA/B,aAAA,KAoCDI,eAAA,CAnDYJ,aAAa,0BACgB,GAAI,CAAAgC,GAAG,EAAE,EAAA5B,eAAA,CADtCJ,aAAa,yBAGe,CAC/BsB,WAAW,UAAAA,YAAA,CAAkB,iBAAAW,QAAA,SAAAC,YAAA,CAAA/B,OAAA,CAAAgC,KAAA,UAAAC,SAAAC,QAAA,iBAAAA,QAAA,CAAAC,IAAA,CAAAD,QAAA,CAAAE,IAAA,0BAAAF,QAAA,CAAAG,IAAA,qBAAAC,OAAA,MACjC,CACD,CACKC,eAAe,UAAAA,gBAAA,CAAkB,iBAAAC,SAAA,SAAAT,YAAA,CAAA/B,OAAA,CAAAgC,KAAA,UAAAS,UAAAC,SAAA,iBAAAA,SAAA,CAAAP,IAAA,CAAAO,SAAA,CAAAN,IAAA,0BAAAM,SAAA,CAAAL,IAAA,qBAAAC,OAAA,MACrC,CAEJ,CAAC"},"metadata":{},"sourceType":"script","externalDependencies":[]}