{"ast":null,"code":"var _interopRequireDefault=require(\"@babel/runtime/helpers/interopRequireDefault\");Object.defineProperty(exports,\"__esModule\",{value:true});exports.makeMutable=makeMutable;exports.makeRemote=makeRemote;exports.makeUIMutable=void 0;var _NativeReanimated=_interopRequireDefault(require(\"./NativeReanimated\"));var _shareables=require(\"./shareables\");var _threads=require(\"./threads\");var _valueSetter=require(\"./valueSetter\");var _worklet_6202761388909_init_data={code:\"function makeUIMutable(initial,syncDataHolder){const{valueSetter,makeShareableCloneOnUIRecursive}=this.__closure;const listeners=new Map();let value=initial;const self={set value(newValue){valueSetter(self,newValue);},get value(){return value;},set _value(newValue){value=newValue;if(syncDataHolder){_updateDataSynchronously(syncDataHolder,makeShareableCloneOnUIRecursive(newValue));}listeners.forEach(function(listener){listener(newValue);});},get _value(){return value;},addListener:function(id,listener){listeners.set(id,listener);},removeListener:function(id){listeners.delete(id);},_animation:null,_isReanimatedSharedValue:true};return self;}\"};var makeUIMutable=exports.makeUIMutable=function(){var makeUIMutable=function makeUIMutable(initial,syncDataHolder){var listeners=new Map();var value=initial;var self={set value(newValue){(0,_valueSetter.valueSetter)(self,newValue);},get value(){return value;},set _value(newValue){value=newValue;if(syncDataHolder){_updateDataSynchronously(syncDataHolder,(0,_shareables.makeShareableCloneOnUIRecursive)(newValue));}listeners.forEach(function(listener){listener(newValue);});},get _value(){return value;},addListener:function addListener(id,listener){listeners.set(id,listener);},removeListener:function removeListener(id){listeners.delete(id);},_animation:null,_isReanimatedSharedValue:true};return self;};makeUIMutable.__closure={valueSetter:_valueSetter.valueSetter,makeShareableCloneOnUIRecursive:_shareables.makeShareableCloneOnUIRecursive};makeUIMutable.__initData=_worklet_6202761388909_init_data;makeUIMutable.__workletHash=6202761388909;return makeUIMutable;}();var _worklet_12435948459793_init_data={code:\"function anonymous(){const{makeUIMutable,initial,syncDataHolder}=this.__closure;return makeUIMutable(initial,syncDataHolder);}\"};var _worklet_12096167784162_init_data={code:\"function anonymous(){const{mutable,newValue}=this.__closure;mutable.value=newValue;}\"};var _worklet_15082063549120_init_data={code:\"function anonymous(){const{mutable,modifier}=this.__closure;mutable.value=modifier(mutable.value);}\"};function makeMutable(initial){var oneWayReadsOnly=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var value=initial;var syncDataHolder;if(!oneWayReadsOnly&&_NativeReanimated.default.native){syncDataHolder=_NativeReanimated.default.makeSynchronizedDataHolder((0,_shareables.makeShareableCloneRecursive)(value));(0,_shareables.registerShareableMapping)(syncDataHolder);}var handle=(0,_shareables.makeShareableCloneRecursive)({__init:function(){var anonymous=function anonymous(){return makeUIMutable(initial,syncDataHolder);};anonymous.__closure={makeUIMutable:makeUIMutable,initial:initial,syncDataHolder:syncDataHolder};anonymous.__initData=_worklet_12435948459793_init_data;anonymous.__workletHash=12435948459793;return anonymous;}()});var listeners=_NativeReanimated.default.native?undefined:new Map();var mutable={set value(newValue){if(_NativeReanimated.default.native){(0,_threads.runOnUI)(function(){var anonymous=function anonymous(){mutable.value=newValue;};anonymous.__closure={mutable:mutable,newValue:newValue};anonymous.__initData=_worklet_12096167784162_init_data;anonymous.__workletHash=12096167784162;return anonymous;}())();}else{(0,_valueSetter.valueSetter)(mutable,newValue);}},get value(){if(syncDataHolder){return _NativeReanimated.default.getDataSynchronously(syncDataHolder);}return value;},set _value(newValue){if(_NativeReanimated.default.native){throw new Error('[Reanimated] Setting `_value` directly is only possible on the UI runtime.');}value=newValue;listeners.forEach(function(listener){listener(newValue);});},get _value(){if(_NativeReanimated.default.native){throw new Error('[Reanimated] Reading from `_value` directly is only possible on the UI runtime.');}return value;},modify:function modify(modifier){(0,_threads.runOnUI)(function(){var anonymous=function anonymous(){mutable.value=modifier(mutable.value);};anonymous.__closure={mutable:mutable,modifier:modifier};anonymous.__initData=_worklet_15082063549120_init_data;anonymous.__workletHash=15082063549120;return anonymous;}())();},addListener:function addListener(id,listener){if(_NativeReanimated.default.native){throw new Error('[Reanimated] Adding listeners is only possible on the UI runtime.');}listeners.set(id,listener);},removeListener:function removeListener(id){if(_NativeReanimated.default.native){throw new Error('[Reanimated] Removing listeners is only possible on the UI runtime.');}listeners.delete(id);},_isReanimatedSharedValue:true};(0,_shareables.registerShareableMapping)(mutable,handle);return mutable;}var _worklet_11709675973052_init_data={code:\"function anonymous(){const{initial}=this.__closure;return initial;}\"};function makeRemote(){var initial=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var handle=(0,_shareables.makeShareableCloneRecursive)({__init:function(){var anonymous=function anonymous(){return initial;};anonymous.__closure={initial:initial};anonymous.__initData=_worklet_11709675973052_init_data;anonymous.__workletHash=11709675973052;return anonymous;}()});(0,_shareables.registerShareableMapping)(initial,handle);return initial;}","map":{"version":3,"names":["_NativeReanimated","_interopRequireDefault","require","_shareables","_threads","_valueSetter","_worklet_6202761388909_init_data","code","makeUIMutable","exports","initial","syncDataHolder","listeners","Map","value","self","newValue","valueSetter","_value","_updateDataSynchronously","makeShareableCloneOnUIRecursive","forEach","listener","addListener","id","set","removeListener","delete","_animation","_isReanimatedSharedValue","__closure","__initData","__workletHash","_worklet_12435948459793_init_data","_worklet_12096167784162_init_data","_worklet_15082063549120_init_data","makeMutable","oneWayReadsOnly","arguments","length","undefined","NativeReanimatedModule","native","makeSynchronizedDataHolder","makeShareableCloneRecursive","registerShareableMapping","handle","__init","anonymous","mutable","runOnUI","getDataSynchronously","Error","modify","modifier","_worklet_11709675973052_init_data","makeRemote"],"sources":["/Users/shayan/workspace/godfather/node_modules/react-native-reanimated/lib/module/reanimated2/mutables.ts"],"sourcesContent":["import NativeReanimatedModule from './NativeReanimated';\nimport type { SharedValue, ShareableSyncDataHolderRef } from './commonTypes';\nimport {\n  makeShareableCloneOnUIRecursive,\n  makeShareableCloneRecursive,\n  registerShareableMapping,\n} from './shareables';\nimport { runOnUI } from './threads';\nimport { valueSetter } from './valueSetter';\n\nexport function makeUIMutable<T>(\n  initial: T,\n  syncDataHolder?: ShareableSyncDataHolderRef<T>\n) {\n  'worklet';\n\n  const listeners = new Map();\n  let value = initial;\n\n  const self = {\n    set value(newValue) {\n      valueSetter(self, newValue);\n    },\n    get value() {\n      return value;\n    },\n    /**\n     * _value prop should only be accessed by the valueSetter implementation\n     * which may make the decision about updating the mutable value depending\n     * on the provided new value. All other places should only attempt to modify\n     * the mutable by assigning to value prop directly.\n     */\n    set _value(newValue: T) {\n      value = newValue;\n      if (syncDataHolder) {\n        _updateDataSynchronously(\n          syncDataHolder,\n          makeShareableCloneOnUIRecursive(newValue)\n        );\n      }\n      listeners.forEach((listener) => {\n        listener(newValue);\n      });\n    },\n    get _value(): T {\n      return value;\n    },\n    addListener: (id: number, listener: (newValue: T) => void) => {\n      listeners.set(id, listener);\n    },\n    removeListener: (id: number) => {\n      listeners.delete(id);\n    },\n    _animation: null,\n    _isReanimatedSharedValue: true,\n  };\n  return self;\n}\n\nexport function makeMutable<T>(\n  initial: T,\n  oneWayReadsOnly = false\n): SharedValue<T> {\n  let value: T = initial;\n  let syncDataHolder: ShareableSyncDataHolderRef<T> | undefined;\n  if (!oneWayReadsOnly && NativeReanimatedModule.native) {\n    // updates are always synchronous when running on web or in Jest environment\n    syncDataHolder = NativeReanimatedModule.makeSynchronizedDataHolder(\n      makeShareableCloneRecursive(value)\n    );\n    registerShareableMapping(syncDataHolder);\n  }\n  const handle = makeShareableCloneRecursive({\n    __init: () => {\n      'worklet';\n      return makeUIMutable(initial, syncDataHolder);\n    },\n  });\n  // listeners can only work on JS thread on Web and jest environments\n  const listeners = NativeReanimatedModule.native ? undefined : new Map();\n  const mutable = {\n    set value(newValue) {\n      if (NativeReanimatedModule.native) {\n        runOnUI(() => {\n          mutable.value = newValue;\n        })();\n      } else {\n        valueSetter(mutable, newValue);\n      }\n    },\n    get value() {\n      if (syncDataHolder) {\n        return NativeReanimatedModule.getDataSynchronously(syncDataHolder);\n      }\n      return value;\n    },\n    set _value(newValue: T) {\n      if (NativeReanimatedModule.native) {\n        throw new Error(\n          '[Reanimated] Setting `_value` directly is only possible on the UI runtime.'\n        );\n      }\n      value = newValue;\n      listeners!.forEach((listener) => {\n        listener(newValue);\n      });\n    },\n    get _value(): T {\n      if (NativeReanimatedModule.native) {\n        throw new Error(\n          '[Reanimated] Reading from `_value` directly is only possible on the UI runtime.'\n        );\n      }\n      return value;\n    },\n    modify: (modifier: (value: T) => T) => {\n      runOnUI(() => {\n        mutable.value = modifier(mutable.value);\n      })();\n    },\n    addListener: (id: number, listener: (value: T) => void) => {\n      if (NativeReanimatedModule.native) {\n        throw new Error(\n          '[Reanimated] Adding listeners is only possible on the UI runtime.'\n        );\n      }\n      listeners!.set(id, listener);\n    },\n    removeListener: (id: number) => {\n      if (NativeReanimatedModule.native) {\n        throw new Error(\n          '[Reanimated] Removing listeners is only possible on the UI runtime.'\n        );\n      }\n      listeners!.delete(id);\n    },\n    _isReanimatedSharedValue: true,\n  };\n  registerShareableMapping(mutable, handle);\n  return mutable;\n}\n\nexport function makeRemote<T extends object>(initial: T = {} as T): T {\n  const handle = makeShareableCloneRecursive({\n    __init: () => {\n      'worklet';\n      return initial;\n    },\n  });\n  registerShareableMapping(initial, handle);\n  return initial;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}