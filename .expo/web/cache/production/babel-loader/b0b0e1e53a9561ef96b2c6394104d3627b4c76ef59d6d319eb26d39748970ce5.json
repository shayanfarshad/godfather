{"ast":null,"code":"var _interopRequireDefault=require(\"@babel/runtime/helpers/interopRequireDefault\");Object.defineProperty(exports,\"__esModule\",{value:true});exports.default=void 0;var _slicedToArray2=_interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));var _classCallCheck2=_interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));var _createClass2=_interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));var _assertThisInitialized2=_interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));var _inherits2=_interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));var _possibleConstructorReturn2=_interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));var _getPrototypeOf2=_interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));var _NativeReanimated2=require(\"../NativeReanimated/NativeReanimated\");var _commonTypes=require(\"../commonTypes\");function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=(0,_getPrototypeOf2.default)(Derived),result;if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2.default)(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return(0,_possibleConstructorReturn2.default)(this,result);};}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));}catch(t){}return(_isNativeReflectConstruct=function _isNativeReflectConstruct(){return!!t;})();}function _defineProperty(obj,key,value){key=_toPropertyKey(key);if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _toPropertyKey(arg){var key=_toPrimitive(arg,\"string\");return typeof key===\"symbol\"?key:String(key);}function _toPrimitive(input,hint){if(typeof input!==\"object\"||input===null)return input;var prim=input[Symbol.toPrimitive];if(prim!==undefined){var res=prim.call(input,hint||\"default\");if(typeof res!==\"object\")return res;throw new TypeError(\"@@toPrimitive must return a primitive value.\");}return(hint===\"string\"?String:Number)(input);}var JSReanimated=exports.default=function(_NativeReanimated){(0,_inherits2.default)(JSReanimated,_NativeReanimated);var _super=_createSuper(JSReanimated);function JSReanimated(){var _this;(0,_classCallCheck2.default)(this,JSReanimated);_this=_super.call(this,false);_defineProperty((0,_assertThisInitialized2.default)(_this),\"nextSensorId\",0);_defineProperty((0,_assertThisInitialized2.default)(_this),\"sensors\",new Map());return _this;}(0,_createClass2.default)(JSReanimated,[{key:\"makeShareableClone\",value:function makeShareableClone(value){return{__hostObjectShareableJSRef:value};}},{key:\"installCoreFunctions\",value:function installCoreFunctions(_callGuard,_valueUnpacker){}},{key:\"scheduleOnUI\",value:function scheduleOnUI(worklet){requestAnimationFrame(worklet);}},{key:\"registerEventHandler\",value:function registerEventHandler(_eventHash,_eventHandler){return'';}},{key:\"unregisterEventHandler\",value:function unregisterEventHandler(_){}},{key:\"enableLayoutAnimations\",value:function enableLayoutAnimations(){console.warn('[Reanimated] Layout Animations are not supported on web yet.');}},{key:\"configureLayoutAnimation\",value:function configureLayoutAnimation(){}},{key:\"registerSensor\",value:function registerSensor(sensorType,interval,iosReferenceFrame,eventHandler){if(!(this.getSensorName(sensorType)in window)){return-1;}var sensor=this.initializeSensor(sensorType,interval);var callback;if(sensorType===_commonTypes.SensorType.ROTATION){callback=function callback(){var _sensor$quaternion=(0,_slicedToArray2.default)(sensor.quaternion,4),qw=_sensor$quaternion[0],qx=_sensor$quaternion[1],qy=_sensor$quaternion[2],qz=_sensor$quaternion[3];var yaw=Math.atan2(2.0*(qy*qz+qw*qx),qw*qw-qx*qx-qy*qy+qz*qz);var pitch=Math.sin(-2.0*(qx*qz-qw*qy));var roll=Math.atan2(2.0*(qx*qy+qw*qz),qw*qw+qx*qx-qy*qy-qz*qz);eventHandler({qw:qw,qx:qx,qy:qy,qz:qz,yaw:yaw,pitch:pitch,roll:roll,interfaceOrientation:0});};}else{callback=function callback(){var x=sensor.x,y=sensor.y,z=sensor.z;eventHandler({x:x,y:y,z:z,interfaceOrientation:0});};}sensor.addEventListener('reading',callback);sensor.start();this.sensors.set(this.nextSensorId,sensor);return this.nextSensorId++;}},{key:\"unregisterSensor\",value:function unregisterSensor(id){var sensor=this.sensors.get(id);if(sensor!==undefined){sensor.stop();this.sensors.delete(id);}}},{key:\"subscribeForKeyboardEvents\",value:function subscribeForKeyboardEvents(_){console.warn('[Reanimated] useAnimatedKeyboard is not available on web yet.');return-1;}},{key:\"unsubscribeFromKeyboardEvents\",value:function unsubscribeFromKeyboardEvents(_){}},{key:\"initializeSensor\",value:function initializeSensor(sensorType,interval){var config=interval<=0?{referenceFrame:'device'}:{frequency:1000/interval};switch(sensorType){case _commonTypes.SensorType.ACCELEROMETER:return new window.Accelerometer(config);case _commonTypes.SensorType.GYROSCOPE:return new window.Gyroscope(config);case _commonTypes.SensorType.GRAVITY:return new window.GravitySensor(config);case _commonTypes.SensorType.MAGNETIC_FIELD:return new window.Magnetometer(config);case _commonTypes.SensorType.ROTATION:return new window.AbsoluteOrientationSensor(config);}}},{key:\"getSensorName\",value:function getSensorName(sensorType){switch(sensorType){case _commonTypes.SensorType.ACCELEROMETER:return'Accelerometer';case _commonTypes.SensorType.GRAVITY:return'GravitySensor';case _commonTypes.SensorType.GYROSCOPE:return'Gyroscope';case _commonTypes.SensorType.MAGNETIC_FIELD:return'Magnetometer';case _commonTypes.SensorType.ROTATION:return'AbsoluteOrientationSensor';}}}]);return JSReanimated;}(_NativeReanimated2.NativeReanimated);","map":{"version":3,"names":["_NativeReanimated2","require","_commonTypes","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf2","default","result","NewTarget","constructor","Reflect","construct","arguments","apply","_possibleConstructorReturn2","t","Boolean","prototype","valueOf","call","JSReanimated","exports","_NativeReanimated","_inherits2","_super","_this","_classCallCheck2","_defineProperty","_assertThisInitialized2","Map","_createClass2","key","value","makeShareableClone","__hostObjectShareableJSRef","installCoreFunctions","_callGuard","_valueUnpacker","scheduleOnUI","worklet","requestAnimationFrame","registerEventHandler","_eventHash","_eventHandler","unregisterEventHandler","_","enableLayoutAnimations","console","warn","configureLayoutAnimation","registerSensor","sensorType","interval","iosReferenceFrame","eventHandler","getSensorName","window","sensor","initializeSensor","callback","SensorType","ROTATION","_sensor$quaternion","_slicedToArray2","quaternion","qw","qx","qy","qz","yaw","Math","atan2","pitch","sin","roll","interfaceOrientation","x","y","z","addEventListener","start","sensors","set","nextSensorId","unregisterSensor","id","get","undefined","stop","delete","subscribeForKeyboardEvents","unsubscribeFromKeyboardEvents","config","referenceFrame","frequency","ACCELEROMETER","Accelerometer","GYROSCOPE","Gyroscope","GRAVITY","GravitySensor","MAGNETIC_FIELD","Magnetometer","AbsoluteOrientationSensor","NativeReanimated"],"sources":["/Users/shayan/workspace/godfather/node_modules/react-native-reanimated/lib/module/reanimated2/js-reanimated/JSReanimated.ts"],"sourcesContent":["import { NativeReanimated } from '../NativeReanimated/NativeReanimated';\nimport {\n  SensorType,\n  ShareableRef,\n  Value3D,\n  ValueRotation,\n} from '../commonTypes';\nimport { WebSensor } from './WebSensor';\n\nexport default class JSReanimated extends NativeReanimated {\n  nextSensorId = 0;\n  sensors = new Map<number, WebSensor>();\n\n  constructor() {\n    super(false);\n  }\n\n  makeShareableClone<T>(value: T): ShareableRef<T> {\n    return { __hostObjectShareableJSRef: value };\n  }\n\n  installCoreFunctions(\n    _callGuard: <T extends Array<any>, U>(\n      fn: (...args: T) => U,\n      ...args: T\n    ) => void,\n    _valueUnpacker: <T>(value: T) => T\n  ): void {\n    // noop\n  }\n\n  scheduleOnUI<T>(worklet: ShareableRef<T>) {\n    // @ts-ignore web implementation has still not been updated after the rewrite, this will be addressed once the web implementation updates are ready\n    requestAnimationFrame(worklet);\n  }\n\n  registerEventHandler<T>(\n    _eventHash: string,\n    _eventHandler: ShareableRef<T>\n  ): string {\n    // noop\n    return '';\n  }\n\n  unregisterEventHandler(_: string): void {\n    // noop\n  }\n\n  enableLayoutAnimations() {\n    console.warn(\n      '[Reanimated] Layout Animations are not supported on web yet.'\n    );\n  }\n\n  configureLayoutAnimation() {\n    // no-op\n  }\n\n  registerSensor(\n    sensorType: SensorType,\n    interval: number,\n    iosReferenceFrame: number,\n    eventHandler: (data: Value3D | ValueRotation) => void\n  ): number {\n    if (!(this.getSensorName(sensorType) in window)) {\n      return -1;\n    }\n\n    const sensor: WebSensor = this.initializeSensor(sensorType, interval);\n    let callback;\n    if (sensorType === SensorType.ROTATION) {\n      callback = () => {\n        const [qw, qx, qy, qz] = sensor.quaternion;\n\n        // reference: https://stackoverflow.com/questions/5782658/extracting-yaw-from-a-quaternion\n        const yaw = Math.atan2(\n          2.0 * (qy * qz + qw * qx),\n          qw * qw - qx * qx - qy * qy + qz * qz\n        );\n        const pitch = Math.sin(-2.0 * (qx * qz - qw * qy));\n        const roll = Math.atan2(\n          2.0 * (qx * qy + qw * qz),\n          qw * qw + qx * qx - qy * qy - qz * qz\n        );\n        eventHandler({\n          qw,\n          qx,\n          qy,\n          qz,\n          yaw,\n          pitch,\n          roll,\n          interfaceOrientation: 0,\n        });\n      };\n    } else {\n      callback = () => {\n        const { x, y, z } = sensor;\n        eventHandler({ x, y, z, interfaceOrientation: 0 });\n      };\n    }\n    sensor.addEventListener('reading', callback);\n    sensor.start();\n\n    this.sensors.set(this.nextSensorId, sensor);\n    return this.nextSensorId++;\n  }\n\n  unregisterSensor(id: number): void {\n    const sensor: WebSensor | undefined = this.sensors.get(id);\n    if (sensor !== undefined) {\n      sensor.stop();\n      this.sensors.delete(id);\n    }\n  }\n\n  subscribeForKeyboardEvents(_: ShareableRef<number>): number {\n    console.warn(\n      '[Reanimated] useAnimatedKeyboard is not available on web yet.'\n    );\n    return -1;\n  }\n\n  unsubscribeFromKeyboardEvents(_: number): void {\n    // noop\n  }\n\n  initializeSensor(sensorType: SensorType, interval: number): WebSensor {\n    const config =\n      interval <= 0\n        ? { referenceFrame: 'device' }\n        : { frequency: 1000 / interval };\n    switch (sensorType) {\n      case SensorType.ACCELEROMETER:\n        return new window.Accelerometer(config);\n      case SensorType.GYROSCOPE:\n        return new window.Gyroscope(config);\n      case SensorType.GRAVITY:\n        return new window.GravitySensor(config);\n      case SensorType.MAGNETIC_FIELD:\n        return new window.Magnetometer(config);\n      case SensorType.ROTATION:\n        return new window.AbsoluteOrientationSensor(config);\n    }\n  }\n\n  getSensorName(sensorType: SensorType): string {\n    switch (sensorType) {\n      case SensorType.ACCELEROMETER:\n        return 'Accelerometer';\n      case SensorType.GRAVITY:\n        return 'GravitySensor';\n      case SensorType.GYROSCOPE:\n        return 'Gyroscope';\n      case SensorType.MAGNETIC_FIELD:\n        return 'Magnetometer';\n      case SensorType.ROTATION:\n        return 'AbsoluteOrientationSensor';\n    }\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}